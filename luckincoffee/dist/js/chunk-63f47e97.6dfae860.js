(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63f47e97"],{"2f14":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));class s{queryString(t){let e="";for(let i in t)e+=`${i}=${t[i]}&`;return e.slice(0,-1)}}const a=new s},"3b6a":function(t,e,i){"use strict";var s=i("dde4"),a=i.n(s);a.a},c84b:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"detail"},[i("van-nav-bar",{attrs:{title:"商品详情","left-text":"返回","left-arrow":"",fixed:!0},on:{"click-left":t.back}}),i("div",{staticClass:"detail-img"},[i("img",{staticClass:"auto-img",attrs:{src:t.product.large_img}}),i("div",{staticClass:"detail-img-text"},[i("div",{staticClass:"detail-img-cntext"},[t._v(t._s(t.product.name))]),i("div",{staticClass:"detail-img-ustext"},[t._v(t._s(t.product.enname))])])]),i("div",{staticClass:"detail-info"},[i("div",{staticClass:"rule-box"},t._l(t.product.rules,(function(e,s){return i("div",{key:s,staticClass:"rule-item clearfix"},[i("div",{staticClass:"rule-item-title "},[t._v(t._s(e.title))]),i("div",{staticClass:"fl clearfix"},t._l(e.rules,(function(e,a){return i("div",{key:a,staticClass:"rule-item-tag fl",class:{active:e.isActive},on:{click:function(i){return t.toggleRule(e,s)}}},[t._v(" "+t._s(e.title)+" ")])})),0)])})),0),i("div",{staticClass:"desc-box"},[i("div",{staticClass:"desc-title"},[t._v("商品描述")]),i("div",{staticClass:"desc-content"},t._l(t.product.desc,(function(e,s){return i("div",{key:s,staticClass:"desc-text"},[t._v(" "+t._s(s+1)+"、"+t._s(e)+" ")])})),0)]),i("div",{staticClass:"clearfix desc-price-count"},[i("div",{staticClass:"fl price"},[t._v("￥"+t._s(t.product.price*t.count))]),i("div",{staticClass:"fr"},[i("van-stepper",{attrs:{theme:"round","button-size":"22","disable-input":""},model:{value:t.count,callback:function(e){t.count=e},expression:"count"}})],1)])]),i("van-goods-action",[i("van-goods-action-icon",{attrs:{icon:"cart",text:"购物车",badge:0==t.badgeCount?"":t.badgeCount,color:"#999"},on:{click:t.toShopBag}}),i("van-goods-action-icon",{class:{active:t.isLike},attrs:{icon:"like",text:"收藏",color:"#999"},on:{click:t.like}}),i("van-goods-action-button",{attrs:{type:"danger",color:"#6a91ec",text:"加入购物车"},on:{click:t.addShopBag}}),i("van-goods-action-button",{attrs:{type:"danger",color:"#0c34ba",text:"立即购买"},on:{click:t.buyNow}})],1)],1)},a=[],o=i("2f14"),r={data(){return{count:1,pid:"",product:[],isLike:!1,badgeCount:0}},created(){this.pid=this.$route.query.pid,this.getProductByPid(),this.findIsLike(),this.findShopBagData()},methods:{back(){this.$router.go(-1)},buyNow(t){this.addShopBag(!0)},toShopBag(){this.$router.push({name:"Shopbag"})},getProductByPid(){this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({methods:"GET",params:{appkey:this.appkey,pid:this.pid},url:"/productDetail"}).then(t=>{if(this.$toast.clear(),600==t.data.code){t.data.result[0].desc=t.data.result[0].desc.split(/\n/);let e=["tem","sugar","cream","milk"],i=[];e.map(e=>{if(""==t.data.result[0][e])return;let s={title:t.data.result[0][e+"_desc"],rules:[]},a=t.data.result[0][e].split("/");a.map((t,e)=>{let i={title:t,isActive:0==e};s.rules.push(i)}),i.push(s)}),t.data.result[0].rules=i,this.product=t.data.result[0]}}).catch(t=>{console.log("error => ",t)})},toggleRule(t,e){if(t.isActive)return;let i=this.product.rules[e].rules;for(let s=0;s<i.length;s++)if(i[s].isActive){i[s].isActive=!1;break}t.isActive=!0},like(){let t=localStorage.getItem("CSTK");if(!t)return void this.$toast("请先登录");let e=o["a"].queryString({appkey:this.appkey,tokenString:t,pid:this.pid}),i=this.isLike?"notlike":"like";this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"POST",url:i,data:e}).then(t=>{if(this.$toast.clear(),700==t.data.code)return this.$router.push({name:"Login"});800==t.data.code?(this.$toast(t.data.msg),this.isLike=!0):900==t.data.code?(this.$toast(t.data.msg),this.isLike=!1):console.log(t.data.msg),console.log(t)}).catch(t=>{console.log("error => ",t)})},findIsLike(){let t=localStorage.getItem("CSTK");t&&(this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"GET",url:"/findAllLike",params:{appkey:this.appkey,tokenString:t}}).then(t=>{if(this.$toast.clear(),2e3==t.data.code){for(let e=0;e<t.data.result.length;e++)if(t.data.result[e].pid==this.pid){this.isLike=!0;break}}else console.log("查询所有收藏结果不成功，=> ",t)}).catch(t=>{console.log("error => ",t)}))},addShopBag(t){let e=localStorage.getItem("CSTK");if(!e)return this.$router.push({name:"Login"});let i=this.product.rules,s="";i.map(t=>{for(let e=0;e<t.rules.length;e++)t.rules[e].isActive&&(s+=t.rules[e].title+"/")}),s=s.slice(0,-1);let a=o["a"].queryString({tokenString:e,appkey:this.appkey,pid:this.pid,rule:s,count:this.count});this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"POST",url:"/addShopcart",data:a}).then(e=>{this.$toast.clear(),3e3==e.data.code&&(1==e.data.status&&this.badgeCount++,!0===t?setTimeout(()=>{this.$router.push({name:"Pay",query:{sids:e.data.sid}})},600):this.$toast(e.data.msg))}).catch(t=>{console.log("error => ",t)})},findShopBagData(){let t=localStorage.getItem("CSTK");t&&(this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"GET",url:"/findAllShopcart",params:{appkey:this.appkey,tokenString:t}}).then(t=>{this.$toast.clear(),console.log(t),5e3==t.data.code&&(this.badgeCount=t.data.result.length)}).catch(t=>{console.log("error => ",t)}))}}},l=r,c=(i("3b6a"),i("2877")),n=Object(c["a"])(l,s,a,!1,null,"303f2c3a",null);e["default"]=n.exports},dde4:function(t,e,i){}}]);
//# sourceMappingURL=chunk-63f47e97.6dfae860.js.map