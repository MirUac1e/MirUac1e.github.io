(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5bea4a99"],{"2f14":function(s,t,e){"use strict";e.d(t,"a",(function(){return i}));class a{queryString(s){let t="";for(let e in s)t+=`${e}=${s[e]}&`;return t.slice(0,-1)}}const i=new a},"76a1":function(s,t,e){"use strict";e.r(t);var a=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"pay"},[e("van-nav-bar",{attrs:{title:"提交订单","left-text":"返回","left-arrow":"",fixed:!0},on:{"click-left":s.back}}),e("div",{staticClass:"address-box"},[e("div",{staticClass:"address"},[e("div",{staticClass:"clearfix",on:{click:s.openAddressBox}},[e("div",{staticClass:"fl address-title"},[s._v("选择收货地址")]),e("div",{staticClass:"fl address-title-icon"},[e("van-icon",{attrs:{name:"arrow"}})],1)]),e("div",{staticClass:"detail-info"},[e("div",{staticClass:"clearfix"},[e("div",{staticClass:"fl name"},[s._v(s._s(s.currentAddress.name))]),e("div",{staticClass:"fl phone"},[s._v(s._s(s.currentAddress.tel))])]),e("div",{staticClass:"address-info"},[s._v(" "+s._s(s.currentAddress.address)+" ")])])])]),e("div",{staticClass:"order-box"},[e("div",{staticClass:"order-info"},[e("div",{staticClass:"order-title"},[s._v("订单信息")]),e("div",s._l(s.productsData,(function(t,a){return e("div",{key:a,staticClass:"clearfix pro-box"},[e("div",{staticClass:"fl pro-img"},[e("img",{staticClass:"auto-img",attrs:{src:t.small_img,alt:""}})]),e("div",{staticClass:"fl pro-info"},[e("div",{staticClass:"clearfix"},[e("div",{staticClass:"name-cn fl"},[s._v(s._s(t.name))]),e("div",{staticClass:"pro-rule fl"},[s._v(s._s(t.rule))])]),e("div",{staticClass:"name-us"},[s._v(" "+s._s(t.enname)+" ")]),e("div",{staticClass:"clearfix btm"},[e("div",{staticClass:"fl pro-price"},[s._v("￥"+s._s(t.price))]),e("div",{staticClass:"fr pro-number"},[s._v("x"+s._s(t.count))])])])])})),0),e("div",{staticClass:"clearfix pro-allinfo"},[e("div",{staticClass:"fl pro-count"},[s._v("共计"+s._s(s.AllCount)+"件商品")]),e("div",{staticClass:"fr pro-total"},[s._v("合计￥"+s._s(s.total))])])])]),e("div",{staticClass:"button-pay"},[e("van-button",{attrs:{type:"default",round:"",block:"",color:"#0c43ba"},on:{click:s.pay}},[s._v("立即结算")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:s.isOpen,callback:function(t){s.isOpen=t},expression:"isOpen"}},[e("div",{staticClass:"select-address-title"},[s._v("选择收货地址")]),e("van-address-list",{attrs:{list:s.list,"default-tag-text":"默认"},on:{select:s.selectAddress,add:s.toAdd},model:{value:s.chosenAddressId,callback:function(t){s.chosenAddressId=t},expression:"chosenAddressId"}})],1)],1)},i=[],r=e("2f14"),d={data(){return{isOpen:!1,chosenAddressId:"",list:[],currentAddress:{name:"",tel:"",address:""},productsData:[],AllCount:0,total:0,sids:[]}},created(){this.findAddress(),this.getShopBagDataBysids()},methods:{back(){this.$router.go(-1)},pay(){if(""==this.chosenAddressId)return void this.$toast("请选择收货地址");let s=localStorage.getItem("CSTK");if(!s)return this.$router.push({name:"Login"});let t=this.$route.query.sids.split("-"),e=r["a"].queryString({appkey:this.appkey,tokenString:s,sids:JSON.stringify(t),phone:this.currentAddress.tel,address:this.currentAddress.address,receiver:this.currentAddress.name});this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"post",url:"/pay",data:e}).then(s=>{this.$toast.clear(),6e4==s.data.code&&(this.$toast(s.data.msg),this.$router.push({name:"Order"})),console.log(s)}).catch(s=>{console.log("error => ",s)})},sum(){this.AllCount=0,this.total=0,this.productsData.map(s=>{this.AllCount+=s.count,this.total+=s.count*s.price})},getShopBagDataBysids(){let s=localStorage.getItem("CSTK");if(!s)return this.$router.push({name:"Login"});let t=this.$route.query.sids.split("-");this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"GET",url:"/commitShopcart",params:{appkey:this.appkey,tokenString:s,sids:JSON.stringify(t)}}).then(s=>{if(this.$toast.clear(),5e4==s.data.code){if(0===s.data.result.length)return this.$router.push({name:"Menu"});s.data.result.map(s=>{this.productsData.push(s)})}this.sum()}).catch(s=>{console.log("error => ",s)})},findAddress(){let s=localStorage.getItem("CSTK");if(!s)return this.$router.push({name:"Login"});this.$toast({message:"加载中",forbidClick:!0,duration:0,loadingType:"spinner"}),this.axios({method:"GET",url:"/findAddress",params:{appkey:this.appkey,tokenString:s}}).then(s=>{this.$toast.clear(),2e4==s.data.code&&s.data.result.map(s=>{this.list.push({id:s.aid,name:s.name,tel:s.tel,address:s.province+s.city+s.county+s.addressDetail,isDefault:1==s.isDefault}),Boolean(s.isDefault)&&(this.currentAddress.name=s.name,this.currentAddress.tel=s.tel,this.currentAddress.address=s.province+s.city+s.county+s.addressDetail,this.chosenAddressId=s.aid)})}).catch(s=>{console.log("error => ",s)})},toAdd(){this.$router.push({name:"Addaddress"})},openAddressBox(){this.isOpen=!0},selectAddress(s,t){this.isOpen=!1,this.currentAddress.name=s.name,this.currentAddress.tel=s.tel,this.currentAddress.address=s.address}}},o=d,n=(e("8c97"),e("2877")),l=Object(n["a"])(o,a,i,!1,null,"7e6bbbea",null);t["default"]=l.exports},"8c97":function(s,t,e){"use strict";var a=e("9591"),i=e.n(a);i.a},9591:function(s,t,e){}}]);
//# sourceMappingURL=chunk-5bea4a99.bb5f189f.js.map